{% extends "app/layout.html" %}

{% block content %}
<div class="row">
    <div class="panel panel-default">
        <div class="panel-body">
            <h1>Simulate Lake Results</h1>
            <p>Date: {{ simDate }}</p>
            <p>Number of Inputs: {{ numOfInputs }}</p>
            <canvas id="simChart"></canvas>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src='https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.3/Chart.min.js'></script>
<script type="text/javascript">
    const monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug",
        "Sept", "Oct", "Nov", "Dec"
    ];

    var simMonth = "{{ simMonth }}"
    var numOfDays = "{{ numOfDays }}"
    var simYear = "{{ simYear }}"
    var userData = "{{ userInputData | safe }}".replace(/[\[\]']+/g, '').split(',')
    var tempData = "{{ temperature_data | safe }}".replace(/[\[\]']+/g, '').split(',')
    var doData = "{{ dissolved_oxygen_data | safe }}".replace(/[\[\]']+/g, '').split(',')
    var days = getDaysInMonth((simMonth - 1), numOfDays, simYear)
    var ctx = document.getElementById('simChart').getContext('2d');
    var chart = new Chart(ctx, {
        // The type of chart we want to create
        type: 'line',

        // The data for our dataset
        data: {
            labels: userData,
            datasets: [{
                    label: 'Temperature (Celcius)',
                    yAxisID: 'A',
                    backgroundColor: 'rgb(255, 0, 0)',
                    borderColor: 'rgb(255, 0, 0)',
                    fill: false,
                    data: tempData,
                },
                {
                    label: 'Dissolved Oxygen Percentage',
                    yAxisID: 'B',
                    backgroundColor: 'rgb(46, 129, 221)',
                    borderColor: 'rgb(46, 129, 221)',
                    fill: false,
                    data: doData
                }
            ]
        },

        // Configuration options go here
        options: {
            scales: {
                xAxes: [{
                    gridLines: {
                        display: false
                    },
                    scaleLabel: {
                        display: true,
                        labelString: 'User Specified Depths'
                    }
                }],
                yAxes: [{
                        id: 'A',
                        type: 'linear',
                        position: 'left',
                        ticks: {
                            callback: function (label, index, labels) {
                                return label + ' \u{2103}'
                            }
                        }
                    },
                    {
                        id: 'B',
                        type: 'linear',
                        position: 'right',
                        ticks: {
                            callback: function (label, index, labels) {
                                return label + '%'
                            }
                        }
                    }
                ]
            }
        }
    });

    function getDaysInMonth(month, numOfDays, year) {
        var date = new Date(year, month, 1);
        var days = [];
        var dayCounter = 0;
        while (date.getMonth() == month) {
            if (dayCounter != numOfDays) {
                var day = new Date(date);
                dayCounter = dayCounter + 1;
                days.push(monthNames[day.getMonth()] + '-' + dayCounter);
                date.setDate(date.getDate() + 1);
            } else {
                break;
            }
        }
        return days;
    }
</script>
{% endblock %}